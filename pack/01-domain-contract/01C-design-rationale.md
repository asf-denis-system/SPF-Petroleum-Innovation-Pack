# Design Rationale Records (DRR)

**Pack:** upstream-petroleum
**FPF Reference:** B.4 — Rationale Transparency Requirement
**Назначение:** Документирование *почему* были приняты ключевые архитектурные решения pack'а. DRR не описывает *что* решено — это есть в других файлах. DRR отвечает на вопрос: *почему именно так, а не иначе?*

---

## Как читать DRR

Каждая запись содержит:
- **Контекст** — ситуация, в которой возникло решение
- **Рассмотренные альтернативы** — что ещё было возможно
- **Принятое решение** — что выбрано
- **Обоснование** — почему именно это
- **Последствия** — что это решение закрывает и что открывает

---

## DRR.001 — Целевая система: нефть, а не пласт

**Дата:** 2026-02-21
**Статус:** Принято
**Авторы:** Д. Асфандияров

### Контекст

При запуске pack'а целевой системой был назначен **пласт** — как объект, которым управляет инженер. Это соответствует классическому инженерному взгляду на upstream: «мы управляем пластом, чтобы добыть нефть».

FPF требует (A.2.1), чтобы целевая система была определена как объект, чьё **состояние** — предмет управления. Пласт при этом — это *среда* (не меняется принципиально, а лишь как ответ на воздействие). Нефть — это *продукт*, который проходит через изменения состояния от «запасы» до «товар».

### Рассмотренные альтернативы

| Кандидат | Аргумент «за» | Аргумент «против» |
|----------|---------------|-------------------|
| **Пласт** | Привычный инженерный фокус; именно пластом «управляют» | Пласт — *среда*, а не продукт; его состояние меняется медленно и косвенно; он не «поставляется» |
| **Пластовая система** (пласт + скважины + инфра) | Более полный объект | Слишком широко; нет единого «состояния» системы целиком |
| **Нефть** | Проходит явные измеримые состояния; застревает на стыках; именно её «поставляют» на НПЗ | Нетрадиционный взгляд для petroleum engineering |

### Принятое решение

**Нефть** — целевая система.
Пласт, скважины, ППД/ГТМ, инфраструктура — управляющие и обеспечивающие системы.

### Обоснование

1. **Нефть имеет измеримые состояния**: локализована, подготовлена к добыче, поднята, поставлена — каждое состояние верифицируемо артефактом.
2. **Потери видны на стыках между состояниями нефти**: узкие места возникают именно там, где нефть «застревает», — и именно там нужны БВ/ТВ.
3. **Пласт — наблюдаемая система, но не конечный продукт**: управляем пластом, чтобы получить нефть; нефть — то, что имеет ценность для потребителя.
4. **Конвейерная метафора работает**: три конвейера (нефть / проекты / технологии) объясняют, как узкое место в добыче превращается в технологический заказ.

### Последствия

- Все описания состояний, владельцев стыков и артефактов ориентированы на нефть, а не на пласт.
- Пласт остаётся важным, но как *среда*, задающая ограничения — не как объект с собственными состояниями в этом pack'е.
- Инварианты (INV.001–INV.006) написаны относительно переходов нефти.

---

## DRR.002 — Модель трёх конвейеров, а не одного

**Дата:** 2026-02-21
**Статус:** Принято
**Авторы:** Д. Асфандияров

### Контекст

В первой версии pack'а была одна цепочка состояний нефти (операционный взгляд). Это объясняло физику, но не объясняло, *как управлять узкими местами* и *как внедрять технологии*.

### Рассмотренные альтернативы

| Подход | Аргумент «за» | Аргумент «против» |
|--------|---------------|-------------------|
| **Один конвейер (нефть)** | Просто; фокус на физике | Нет места для проектов и технологий; innovation loop не виден |
| **Два конвейера (нефть + проекты)** | Добавляет управленческий взгляд | R&D/НИОКР остаётся невидимым; технология = чёрный ящик |
| **Три конвейера** | Покрывает все три уровня: операционный, управленческий, R&D | Сложнее для освоения |

### Принятое решение

**Три конвейера:**
1. Конвейер нефти — операционный (физические состояния)
2. Конвейер проектов — управленческий (БВ/ТВ → тиражирование)
3. Конвейер технологий — R&D (концепция → упакованный метод)

### Обоснование

1. **Причинно-следственная связь замкнута**: узкое место на конвейере нефти → регистрируется как БВ/ТВ → входит в конвейер проектов → заказывает технологию → конвейер технологий → результат возвращается в конвейер нефти.
2. **Без конвейера технологий нет квалификации**: технология применяется без ОПИ/ОПР → нарушается INV.002.
3. **Три конвейера — три разных SLA**: у каждого конвейера своя скорость, свои gate-решения, свои артефакты.

### Последствия

- Каждый конвейер имеет явного владельца стыка на каждом переходе.
- Gate-решения (GO/NO-GO/PIVOT) обязательны на конвейере проектов.
- ОПИ/ОПР — обязательный этап конвейера технологий перед возвратом в конвейер нефти (INV.002).

---

## DRR.003 — SPF как Production Layer поверх FPF

**Дата:** 2026-02-19
**Статус:** Принято
**Авторы:** Д. Асфандияров

### Контекст

SPF (Second Principles Framework) использует понятийный аппарат FPF (First Principles Framework). Необходимо было определить тип отношения: SPF — это *расширение* FPF, *подмножество*, или *независимый фреймворк*?

### Рассмотренные альтернативы

| Отношение | Смысл | Риск |
|-----------|-------|------|
| **Расширение** | SPF добавляет концепты поверх FPF | Размывает ответственность: что из FPF применимо «как есть»? |
| **Подмножество** | SPF использует часть FPF | Неточно: SPF добавляет доменные концепты, которых нет в FPF |
| **Production Layer** | SPF операционализирует FPF для конкретной области | Чётко: FPF — мета-уровень, SPF — реализация на уровне домена |

### Принятое решение

SPF — **Production Layer** поверх FPF.

Это означает:
- FPF задаёт meta-онтологию (System, State, Agent, Method, Work Product, Failure Mode)
- SPF операционализирует эти концепты для домена upstream petroleum
- При конфликте интерпретаций — FPF имеет приоритет

### Обоснование

1. **Уровни абстракции разные**: FPF работает с «системами вообще»; SPF — с «нефтью, пластом, скважинами».
2. **FPF не знает про ОПИ/ОПР, ГДМ, КИН**: доменные концепты добавляются на уровне SPF.
3. **Обратная совместимость**: если FPF обновится, SPF должен адаптироваться — а не наоборот.

### Последствия

- Все ID в этом pack'е (`UP.PP.001`, `R.001`, `FM.PHYS.001`) — это SPF-ID, а не FPF-ID.
- Каждый концепт SPF трассируется к FPF-концепту (см. таблицу маппинга в [00-pack-manifest.md](../00-pack-manifest.md)).
- Lint-проверки FPF применяются к этому pack'у в полном объёме.

---

## DRR.004 — Инварианты как защита от дрейфа контекста

**Дата:** 2026-02-21
**Статус:** Принято
**Авторы:** Д. Асфандияров

### Контекст

В практике нефтяных компаний распространены решения, которые нарушают базовые принципы модели (например, тиражирование технологии без ОПИ, добыча без анализа энергетического баланса). Нужен механизм, который явно маркирует такие нарушения.

### Принятое решение

Ввести **инварианты** (INV.001–INV.006) — правила, нарушение которых означает выход за рамки bounded context.

### Обоснование

- Инварианты — это не рекомендации. Это граница: если правило нарушено, решение принято вне этой модели и не покрывается её гарантиями.
- Инварианты позволяют проводить **аудит решений**: можно проверить, соответствует ли конкретный проект модели.

### Последствия

- 6 инвариантов покрывают: артефакты перехода (INV.001), квалификацию технологий (INV.002), энергетический баланс (INV.003), границы применимости (INV.004), baseline (INV.005), владельца стыка (INV.006).
- Failure modes в `05-failure-modes/` трассированы к нарушениям конкретных инвариантов.

---

## Индекс DRR

| ID | Решение | Дата | Статус |
|----|---------|------|--------|
| DRR.001 | Целевая система: нефть, а не пласт | 2026-02-21 | Принято |
| DRR.002 | Модель трёх конвейеров, а не одного | 2026-02-21 | Принято |
| DRR.003 | SPF как Production Layer поверх FPF | 2026-02-19 | Принято |
| DRR.004 | Инварианты как защита от дрейфа контекста | 2026-02-21 | Принято |

---

*FPF Reference: B.4 — Rationale Transparency Requirement*
*Обновлено: 2026-02-22*
